<!DOCTYPE html>
<html lang="ru">

  <head>
    <title>Архитектура и программирование компьютера Texas Instruments TI-99&#x2F;4a &#x2F; Хабр</title>

































    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
  </head>
  <body>
    
    <div id="mount"><div id="app"><div class="tm-layout__wrapper"><!--[--><!----><div></div><div class="header-banner-wrapper"><div class="element-wrapper above-header" style="--754c4550:100%;--56cb6579:auto;"><!--[--><div class="placeholder-wrapper banner-container__placeholder"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="adfox-banner-placeholder above-header" data-v-24012b5e><div class="image loads" data-v-24012b5e></div><div class="lines" data-v-24012b5e><div class="line loads" data-v-24012b5e></div><div class="line loads" data-v-24012b5e></div><div class="line loads" data-v-24012b5e></div></div></div><!----><!----><!----></div><!--[--><div id="adfox_175449164307199013_aboveHeader" class="banner-target"></div><!--]--><!--]--></div></div><header class="tm-header tm-header" data-test-id="header"><!----><!----><div class="tm-page-width"><!--[--><div class="tm-header__container"><button aria-expanded="false" aria-label="Toggle menu" class="burger-button tm-header__button tm-header__burger" data-v-56ed7aae><span class="line top" data-v-56ed7aae></span><span class="line middle" data-v-56ed7aae></span><span class="line bottom" data-v-56ed7aae></span></button><span class="tm-header__logo-wrap"><a class="tm-header__logo tm-header__logo_hl-ru tm-header__logo" href="/ru/feed"><svg class="tm-svg-img tm-header__icon" height="16" width="16"><title>Хабр</title><use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a></span><span class="tm-header__divider"></span><!--[--><a class="tm-header__all-flows" href="/ru/articles/">Все потоки</a><!--]--><!----><div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search" data-test-id="search-button"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search" height="24" width="24"><title>Поиск</title><use xlink:href="/img/megazord-v28.cba4c116..svg#search"></use></svg></a><!----><!----><div class="tm-header-user-menu__item tm-header-user-menu__write"><a href="/ru/sandbox/start/" class=""><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_write" height="24" width="24"><title>Написать публикацию</title><use xlink:href="/img/megazord-v28.cba4c116..svg#write"></use></svg></a><!----></div><!--[--><div class="tm-header-user-menu__item"><button class="tm-header-user-menu__toggle" data-test-id="user-menu-settings"><svg class="tm-svg-img tm-header-user-menu__icon" height="24" width="24"><title>Настройки</title><use xlink:href="/img/megazord-v28.cba4c116..svg#page-settings"></use></svg></button></div><a href="https://habr.com/kek/v1/auth/habrahabr/?back=/ru/articles/313058/&amp;hl=ru" rel="nofollow" class="tm-header-user-menu__item tm-header-user-menu__login" role="button"><!--[-->Войти<!--]--></a><!--]--><template><!----></template><!--teleport start--><!--teleport end--></div></div><!--]--></div></header><div class="tm-layout"><div class="tm-page-progress-bar"></div><!----><div class="tm-page-width"><!--[--><!----><!----><!----><!--]--></div><main class="tm-layout__container"><div class="tm-page" hl="ru" data-async-called="true" style="--a414e232:300px;--10c4682a:0;--19620736:0;"><!----><div class="tm-page-width"><!--[--><!----><div class="tm-page__wrapper"><!----><div class="tm-page__main_has-sidebar tm-page__main"><div class="pull-down"><!----><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg class="tm-svg-img pull-down__icon pull-down__arrow" height="24" width="24"><title>Обновить</title><use xlink:href="/img/megazord-v28.cba4c116..svg#pull-arrow"></use></svg></div></div><!--[--><div><!--[--><!----><div class="tm-article-presenter" data-async-called="true"><!--[--><!--]--><div class="tm-article-presenter__body" data-test-id="article-body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><!--[--><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><!--[--><div class="tm-article-presenter__header"><!--[--><!--]--><div class="article-snippet tm-article-presenter__snippet" data-v-085cd854><!--[--><!--]--><div class="meta-container" data-v-085cd854><div class="meta" data-v-085cd854><span class="tm-user-info author" data-v-085cd854><a href="/ru/users/frog/" class="tm-user-info__userpic" data-test-id="user-info-pic"><!--[--><div class="tm-entity-image"></div><!--]--></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/frog/" class="tm-user-info__username" data-test-id="user-info-username"><!--[-->frog<!--]--></a><!----><!--[--><span class="tm-article-datetime-published" data-v-085cd854><time data-allow-mismatch datetime="2016-10-18T23:47:34.000Z" title="2016-10-18, 23:47">18  окт  2016 в 23:47</time></span><!--]--></span></span></div><div class="controls" data-v-085cd854><!----><!----><!----><!----></div></div><h1 class="tm-title tm-title_h1" lang="ru" data-test-id="articleTitle" data-v-085cd854><span>Архитектура и программирование компьютера Texas Instruments TI-99/4a</span></h1><div class="stats" data-test-id="articleStats" data-v-085cd854><!----><div class="tm-article-reading-time" data-v-085cd854><span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Время на прочтение</title><use xlink:href="/img/megazord-v28.cba4c116..svg#clock"></use></svg></span><span class="tm-article-reading-time__label">24 мин</span></div><span class="tm-icon-counter tm-data-icons__item reach-counter" data-v-085cd854><svg class="tm-svg-img tm-icon-counter__icon" height="24" width="24"><title>Охват и читатели</title><use xlink:href="/img/megazord-v28.cba4c116..svg#counter-views"></use></svg><span class="tm-icon-counter__value" title="9111">9.1K</span></span></div><div class="tm-publication-hubs__container" data-test-id="articleHubsList" data-v-085cd854><div class="tm-publication-hubs"><!--[--><span class="tm-publication-hub__link-container"><a href="/ru/hubs/assembler/" class="tm-publication-hub__link"><!--[--><span>Assembler</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб"> * </span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/demoscene/" class="tm-publication-hub__link"><!--[--><span>Демосцена</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб"> * </span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/crazydev/" class="tm-publication-hub__link"><!--[--><span>Ненормальное программирование</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб"> * </span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/antikvariat/" class="tm-publication-hub__link"><!--[--><span>Старое железо</span><!----><!--]--></a></span><!--]--></div></div><div class="tm-article-labels" data-test-id="articleLabels" data-v-085cd854 data-v-bfa2437b><div class="tm-article-labels__container" data-v-bfa2437b><!----><!--[--><!----><!--[--><!--]--><!--]--></div></div><!----><!----><!--teleport start--><!--teleport end--></div></div><!--[--><!----><div class="article-body" data-gallery-root lang="ru" data-v-aad06d04><div data-v-aad06d04><!--[--><!--]--></div><div id="post-content-body" data-v-aad06d04><div><div class="article-formatted-body article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml">Компьютер <a href="https://en.wikipedia.org/wiki/Ti-99">Texas Instruments TI-99/4a</a> почти неизвестен за пределами США, однако он был там весьма популярен (выпущено более двух миллионов машин). Хотя этот компьютер создавался как домашний, существенной особенностью (во многом определившей его архитектуру, а затем и судьбу) было то, что за основу был взяли уже существовавший серьёзный мини-компьютер <a href="https://en.wikipedia.org/wiki/TI-990">TI-990</a>, собранный на обычной ТТЛ логике. Фактически, микропроцессор TMS9900 в компьютере TI99/4A является реализацией TI-990, но в виде чипа. TI-990 был выпущен в 1975 году, а TMS9900 в 1976 году.<br/>
<br/>
 Таким образом, TI99/4a (в 1979 был выпущен чуть более простой TI-99/4, а в 1981 уже TI-99/4a) получил в наследство крайне странную, для домашних компьютеров, архитектуру. Во-первых, микропроцессор TMS9900 в нём 16-разрядный — с честной 16-разрядной шиной данных (это в конце 1970-х!). Во-вторых, на чипе нет регистров (кроме PC, флагов и указателя «регистров» WP). То, что можно назвать регистрами, находится в отдельной микросхеме 16-разрядного статического ОЗУ размером 256 байт и может адресоваться одновременно как память и (первые 16 слов) как регистры R0..R15. Называется это «scratchpad».<br/>
Аппаратного стека нет, вместо этого сохранение значений при вызове подпрограмм осуществляется изменением указателя начала регистров WP в этом самом ОЗУ (напоминает регистровые окна в Sparc'ах). В предке (TI-990) это также использовалось для переключения контекста при реализации многозадачности.<br/>
Хотя тактовая частота TMS9900 — 3 МГц, инструкции занимают довольно много тактов — не менее 8. При этом реализовано даже умножение и деление (124 такта).<br/>
<a name="habracut"></a><br/>
<a href="https://habrastorage.org/files/334/79c/474/33479c47461a4e11892b719b110dcae3.jpg"></a> Всё, кроме процессора, увы, более аскетично. Кроме упомянутого крохотного статического ОЗУ есть ещё видеопамять — 16кб медленной 8-разрядной DRAM, доступ к которой осуществляется через видеоконтроллер. <br/>
<br/>
Другими словами, без дополнительной периферии TI99/4A представляет собой 16-разрядный компьютер с ОЗУ 256 байт, встроенными в ПЗУ BASIC и программами на картриджах (в них до 8кб честно адресуемого ПЗУ или более, с разными хитростями ).<br/>
<br/>
В голый компьютер даже с кассеты загрузить нормальную программу невозможно, т.к. нет для этого ОЗУ (256 байт не в счёт, а остальное — видеопамять). <br/>
<br/>
Поэтому минимально-адекватная конфигурация компьютера, это PEB (Peripheral Expansion Box) — специальная большая корзина для плат расширения, дисковод и расширение памяти 32kb. Либо NanoPEB — современное устройство, включающее всё перечисленное. <br/>
<br/>
К PEB/NanoPEB необходим ещё картридж Editor/Assembler (без которого можно загружать и запускать лишь программы на Бейсике и который заодно содержит упомянутые дополнительные 32kb ОЗУ).<br/>
<br/>
<a href="https://habrastorage.org/files/438/eb0/5ca/438eb05cada9404f9cc2839103ddaf42.jpg"></a> Видеоконтроллер TMS9918 (также используемый в MSX и ColecoVision) поддерживает графический (256x192, 15 цветов) и текстовый режимы, позволяет менять знакогенератор, может выводить одновременно 32 аппаратных спрайта 8x8 и 16x16 (правда, в одной строке может находиться одновременно не более четырёх штук).<br/>
Звук выводится через TMS9919 (его аналог, SN76489, использовался в IBM PCjr, BBC Micro, ColecoVision, некоторых консолях Sega):<br/>
<br/>
4 канала (три генератора прямоугольников и один — шума), 16 уровней громкости.<br/>
<br/>
Считается, что такая неравномерная в плане разрядности и местами несуразная архитектура получилась из-за того, что не была во-время готова 8-разрядная версия процессора TMS9900 (TMS9985).<br/>
<br/>
Что касается программного обеспечения, то TI99/4A предназначался для целей образования (фактически, в противовес Atari и Commodore). В совокупности с описанными выше странностями архитектуры это привело к тому, что хороших игр на нём весьма немного (если вообще есть). Тот факт, что компьютер был распространён исключительно в США, добавил к этому ещё и отсутствие демосцены (моя интро 99tro была, кажется, второй на этой платформе).<br/>
<br/>
<h2>СОВРЕМЕННОЕ СОСТОЯНИЕ ДЕЛ</h2><br/>
Как уже было упомянуто, с голым TI99/4a мало что можно сделать, разве что с картриджей что-то запускать (если они есть). Необходимая для нормальной работы корзина расширения PEB стоит весьма недёшево и занимает много места. Поскольку исторически получилось так, что вся серьёзная разработка и вообще какие-либо действия с TI были завязаны на тот самый PEB, современные фанаты машинки пошли по пути его эмуляции (с эмулятором ROM картриджей даже никто, похоже, и не заморачивался).<br/>
<br/>
Современным заменителем PEB является <a href="http://webpages.charter.net/nanopeb/">NanoPEB</a>. При некотором терпении его можно найти на ebay или у отдельных продавцов за 50...80e.<br/>
<br/>
Это устройство втыкается в правый порт компьютера (туда же, куда и синтезатор речи. В т.ч. можно воткнуть его через синтезатор) и эмулирует 32кб дополнительного ОЗУ, три дисковода (на CompactFlash карте) и порт RS-232.<br/>
<br/>
Существует также устройство CF7+, в котором всё тоже самое, но вместо RS-232 имеется параллельный порт Centronics.<br/>
<br/>
Само по себе наличие NanoPEB позволяет загружать лишь программы на Бейсике (а из стандартного TI Бейсика невозможно запустить программу в машинных кодах, если не считать совсем уж грязных и нетривиальных хаков).<br/>
<br/>
Поэтому совершенно необходим ещё картридж Editor/Assembler (EA), втыкаемый в верхний порт. С ним уже можно загружать и запускать нормальные программы. Картридж также ищется на Ebay. Вроде бы, вместо него можно использовать картридж Extended Basic (XB).<br/>
<br/>
Для переноса программ на CompactFlash карту необходимо использовать специальные утилиты. Самая популярная — ti99dir (под Windows).<br/>
<br/>
Стоит упомянуть проект <a href="http://codehackcreate.com/archives/category/projects/f18a">F18A</a> — реализацию видеоконтроллера TMS9918A на FPGA, с рядом дополнений. Т.е. видеочип в обычном TI-99/4a заменяется на новый, при этом весь старый софт идёт как прежде, но появляется возможность выводить изображение на VGA монитор, устанавливать ранее недоступные видеорежимы и т.п.<br/>
<br/>
<h2>РАЗРАБОТКА</h2><br/>
Помимо программ на Basic, о которых мы говорить не будем, существует два основных формата, в которых может быть представлена программа в машинных кодах — для загрузки с диска через Editor/Assembler и для картриджа.<br/>
<br/>
Файлы, загружаемые через EA, называются EA3 (потому, что в Editor/Assembler для их загрузки надо выбрать третий пункт меню — «LOAD AND RUN»). Они могут запускаться в любой области памяти (т.е. EA при загрузки выполняет линковку). Для эмулятора такие файлы хранятся на образе дисков (.DSK) и имеют формат Dis/Fix 80.<br/>
<br/>
Так же, реже, могут попадаться memory image файлы называемые EA5 (в EA загружаются выбором пятого пункта меню — «RUN PROGRAM FILE»). Это уже слинкованные файлы, привязанные к адресам памяти. В эмуляторе также хранятся в образах дисков как «Program».<br/>
<br/>
Загрузка с диска программы в кодах в обязательном порядке требует катриджа Editor/Assembler (или аналога).<br/>
<br/>
Программы для картриджей жёстко привязаны к адресам и представляют собой просто бинарник, который прошивается в ПЗУ (для эмуляторов это формат .RPK, реже — .BIN).<br/>
<br/>
Существует два существенно различных подхода к написанию программ на ассемблере. Первый — использование т.н. языка GPL. Это что-то среднее между Extended Basic (XB) и Assembler, как по производительности, так и по возможностям. Т.е. для всего интенсивно используются подпрограммы существующие в ПЗУ и, что важно, должны быть включены прерывания.<br/>
<br/>
Второй вариант — ассемблер, о котором и пойдёт речь.<br/>
<br/>
Основная необычность TI-99/4A, по сути, в процессоре TMS9900. От большинства процессоров, которые использовались в домашних компьютерах того времени, его отличает следующее:<br/>
<br/>
Физически в процессоре всего три регистра — ST (флаги), PC (указатель команды) и WP (указатель рабочей области). Регистры R0-R15 находятся в статическом ОЗУ снаружи чипа. Адрес, с которого они начинаются, хранится в регистре WP и может быть изменён. Обычно его устанавливают равным &gt;8300 (знак "&gt;" означает шестнадцатиричную систему, знак ":" — двоичную). <br/>
<br/>
С &gt;8300 по &gt;83FF находится 256 байт статического 16-разрядного ОЗУ, называемого «scratchpad». <br/>
<br/>
Работа с ним примерно в 2 раза быстрее, чем с остальным динамическим 8-разрядным (стандартным расширением 32kb).<br/>
<br/>
При этом имеется много режимов адресации и одной командой можно, к примеру, перенести значение из ячейки памяти в другую, заодно его изменив.<br/>
<br/>
В процессоре нет стека — предполагается использование отображения регистров на любую область памяти командой LWPI addr для сохранения и восстановления контекста.<br/>
Вызов подпрограмм осуществляется командой BL <a href="https://habr.com/users/addr/" class="user_link">ADDR</a>, которая заносит в регистр R11 следующий после неё адрес. Соответственно, для возврата используется B *R11 (она же RT). Есть также BLWP, сохраняющая кроме адреса возврата ещё и workspace (но при этом медленная).<br/>
<br/>
Обычно первым делом выключают все прерывания и устанавливают начало регистров на начало статического ОЗУ. Поэтому заготовка программы выглядит так:<br/>
<br/>
<pre><code>       DEF  START

WRKSP  EQU  &gt;8300

START  LIMI 0
       LWPI  WRKSP

...

* SOME CODE HERE

       END START
</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Из-за такой регистровой архитектуры появляются особенности программирования. А именно:<br/>
<br/>
1. К регистрам можно обращаться не только как к R1, R2 и т.д., но (поскольку они находятся в адресном пространстве) и как к ячейкам памяти. Это, в частности, позволяет работать отдельно с младшими и старшими байтами регистра, которые для этого заранее задают константами:<br/>
<br/>
<pre><code>ws0       equ  &gt;8300               ; Workspace 0

; Register direct low-byte access

R0L       equ  ws0+1               ; Workspace 0 R0 low byte
R1L       equ  ws0+3               ; Workspace 0 R1 low byte
R2L       equ  ws0+5               ; Workspace 0 R2 low byte
</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Однако понятно, что далеко не всегда в команде можно просто заменить регистр на память (для данной команды может просто не оказаться нужного режима адресации).<br/>
<br/>
С другой стороны, это всё равно бывает необходимо, т.к. команд, работающих с половинками регистров — немного (MOVB, SWPB, AB, SB, некоторая логика).<br/>
<br/>
Конечно, независимо от текущего установленного workspace всегда есть доступ к любому регистру в любом workspace (по соответствующему ему адресу в памяти).<br/>
<br/>
2.Поскольку стека нет (иногда, впрочем, его имитируют программно), сохранение и восстановление регистров осуществляется переключением workspace. Если этим пользоваться интенсивно, имеющиеся 256 байт быстрого SRAM закончатся быстро — их не хватает всегда.<br/>
<br/>
Чтобы показать, как выглядит код для TMS9900, небольшой пример — Hello World:<br/>
<br/>
<pre><code>        DEF     START

WRKSP   EQU     &gt;8300

VDPWD   EQU     &gt;8C00           * VDP RAM write data
VDPWA   EQU     &gt;8C02           * VDP RAM read/write address


START   LIMI    0               * disable interrupts
        LWPI    WRKSP           * set default workspace

* set VDP RAM start address (low and high byte)

        LI      R0,&gt;0000
        ORI     R0,&gt;4000
        SWPB    R0
        MOVB    R0,@VDPWA
        SWPB    R0
        MOVB    R0,@VDPWA

        LI      R1,HELLOWORLD   * ascii string address
        LI      R2,12           * total chars

NEXTCHAR
        MOVB    *R1+,@VDPWD     * put next char on screen
        DEC     R2
        JNE     NEXTCHAR

LOOPBACK
        JMP LOOPBACK            * stop and do nothing


HELLOWORLD
        TEXT 'HELLO WORLD!'     * string data
        BYTE 0

        END START
</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Это современный (не совсем традиционный) ассемблер TMS9900. В первоначальном, помимо отсутствия двоеточий после меток, регистры записывались не как R с цифрой, а как просто цифра. Т.е. LI 4,5 и MOV 7,8 в старом ассемблере это LI R4,5 и MOV R7,R8 в новом.<br/>
<br/>
Как легко видеть, это не сильно добавляло читаемости, так что теперь пишут R (хотя, даже современные ассемблеры понимают старый вариант записи). Некоторые люди, впрочем, мешают оба синтаксиса. В результате в одном и том же исходнике можно встретить рядом мнемоники SLA R5,0 (сдвиг R5 влево на количество разрядов из регистра R0) и SLA R5,1 (сдвиг R5 влево на _один_ разряд).<br/>
<br/>
Некоторый (медицинский :) интерес представляет команда X, выполняющая инструкцию, код которой передаётся ей в качестве параметра.<br/>
<br/>
<pre><code>; Здесь на самом деле выполняется инструкция B *R11

       LI   R9,&gt;045B     ; код инструкции B *R11
       X    R9

; А здесь на самом деле выполняется инструкция LI R1,&gt;1234

       LI   R0,&gt;0201     ; код инструкции LI R1,xxx
       X    R0
       DATA &gt;1234        ; это операнд xxx (&gt;1234) для этой инструкции
</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Считается, что X можно использовать в целях отладки, а также для переходов по табличкам. Ну и в любых ситуациях, где нужен самомодифицирующийся код.<br/>
<br/>
<h2>КАРТА ПАМЯТИ</h2><br/>
<blockquote><b>&gt;0000 -----------</b><br/>
Console ROM<br/>
<b>&gt;2000 -----------</b><br/>
Low memory expansion<br/>
<b>&gt;4000 -----------</b><br/>
Peripheral cards ROM<br/>
<b>&gt;6000 -----------</b><br/>
Cartridge ROM/RAM<br/>
<b>&gt;8000 -----------</b><br/>
Scratchpad RAM memory mapped devices<br/>
(С &gt;8300 по &gt;83FF находится статическое ОЗУ объемом 256 байт.<br/>
Регистры процессора чаще всего отображают начиная с &gt;8300. С &gt;8400 по &gt;9C02 адреса для доступа к видео, звуку, синтезатору, GROM )<br/>
<b>&gt;A000 -----------</b><br/>
High memory expansion<br/>
(стандартное расширение ОЗУ 32kб. С &gt;A000 обычно начинается типичная загружаемая с диска программа)<br/>
…<br/>
<b>&gt;FFFF</b></blockquote><br/>
Что касается ПЗУ, в TI-99/4a используются так называемые GROM. Они не отображаются целиком в адресное пространство процессора, а доступ к данным осуществляется последовательно — по специальному адресу заносится начальный адрес данных в GROM и затем по другому специальному адресу оттуда читаются данные. При этом текущий адрес данных GROM увеличивается автоматически, при каждом чтении.<br/>
<br/>
Печать строки символов из GROM<br/>
<br/>
<pre><code>          li  r0, &gt;0874           ; starting GROM address of small character set  GROMSC
          movb r0,@GROMWA          ; set GROM read pointer to address 06B0 (high part)
          nop                      ; wait a beat (not sure if necessary)
          movb @WR0LB,@GROMWA      ; set GROM read pointer to address 06B0 (low part)


          li   r0,&gt;0000+(8*32*8)            ; VDP Pattern Table start address

          movb @R0L,@vdpwa         ; Send low byte of VDP RAM write address
          ori  r0,&gt;4000            ; Set read/write bits 14 and 15 to write (01)
          movb r0,@vdpwa           ; Send high byte of VDP RAM write address

          li   r1,GROMRD

          li   r2,32
nextchar:
          movb *r1,@vdpwd
          movb *r1,@vdpwd
          movb *r1,@vdpwd
          movb *r1,@vdpwd
          movb *r1,@vdpwd
          movb *r1,@vdpwd
          movb *r1,@vdpwd
;          movb *r1,@vdpwd
          clr @vdpwd          ; skip one byte
          dec  r2
          jne  nextchar
</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
<h2>ГРАФИКА</h2><br/>
Для вывода графики и текста, в TI-99/4a установлен видеочип VDP TMS9918a, который используется также в <a href="https://en.wikipedia.org/wiki/MSX">MSX1</a> и <a href="https://en.wikipedia.org/wiki/ColecoVision">ColecoVision</a>.<br/>
VDP позволяет выводить графику с разрешением 256x192 в 15 не слишком удачных цветах (+1 прозрачный, через который просвечивает фон) и одноцветные спрайты — 32 штуки одним размером 8x8 либо 16x16 с существенным ограничением: не более 4-х спрайтов на одной строке. <br/>
<br/>
В VDP 16kb DRAM и она распределяется между графикой (текстом), цветами и спрайтами.<br/>
<br/>
Видеопамять не отображается в адресное пространство процессора. Для записи в неё нужно сначала занести по определённому адресу начальный адрес в видеопамяти, по которому будет осуществляться запись, а затем писать подряд нужные значения по другому адресу (одному). При этом каждое следующее значение окажется в видеопамяти по увеличивающемуся на единицу адресу.<br/>
<br/>
Взависимости от видеорежима и распределения памяти можно выбрать оптимальный — с точки зрения удобства адресации, используемой памяти и количества цветов (в пиксельном блоке) режим. По своей сути все режимы — текстовые. В том смысле, что во всех случаях есть понятие «символы» (characters), которые можно помещать в разные места экрана и которые можно менять. Но, поскольку можно перепрограммировать символы так, чтобы их вид соответствовал их коду, то по факту режим уже оказывается «графическим». Впрочем, это типично для многих видеоконтроллеров 1980-х. Даже в сравнительно современном VGA была такая возможность (автор её использовал для реализации быстрого режима 640x400 с отдельной памятью для цветов).<br/>
<br/>
Чаще всего в TI используется Graphic Mode I (именно в этом режиме оказывается компьютер при включении и инициализации). В нём можно задать два цвета (фона и изображения) на блок 8x8. Всего блоков 32x24. Единственное преимущество этого режима — сравнительно высокая скорость изменения цветов.<br/>
<br/>
Есть также Multicolor mode — графический режим с разрешением 64x48, где на каждый крупный пиксел задаётся цвет (но при таком разрешении разве что плазму какую-нибудь рисовать или ANSI art ) и пара чисто текстовых режимов 40x24 символа — цветной и монохромный.<br/>
<br/>
Наиболее мощным и интересным режимом в VDP представляется так называемый Graphic Mode II (он же «bitmap mode»). Этот режим позволяет использовать два цвета (фона и изображения) внутри пиксельного блока 8x1. Иными словами — 2 цвета на каждые 8 горизонтальных пикселов. К сожалению, порядок блоков (что пикселов, что их цветов) крайне неудобен для всего, кроме вывода символов — байты идут сверху вниз 0-8, затем следующий правее опять сверху вниз 8-15 и т.д. до правого края. Далее всё повторяется вновь слева направо.<br/>
<br/>
При установке режима также задаются адреса для атрибутов (Color Table), битмапа (Pattern), порядка символов, образующих блоки для битмапа (Name table), данных для спрайтов (Sprites data) и атрибутов спрайтов (Sprites Attributes). Адреса можно задать не любые — там просто несколько вариантов, которые следует выбрать так, чтобы в итоге без нахлёстов рационально использовались все 16384 байта видеопамяти. К примеру, для своей intro «99tro» я распределил память так (Graphics Mode II):<br/>
<br/>
<blockquote>&gt;0000 — &gt;1800 Pattern table — 6144 bytes (&gt;1800)<br/>
&gt;1800 — &gt;2000 Sprite patterns — 64 sprites x 32 bytes = 2048 bytes (&gt;800) <br/>
&gt;2000 — &gt;3800 Color table — 6144 bytes (&gt;1800)<br/>
&gt;3800 — &gt;3b00 Name table — 768 bytes (&gt;300)<br/>
&gt;3b00 — &gt;3b80 Sprite attrs =32 sprites x 4 bytes = 128 bytes (&gt;80)</blockquote><br/>
Спрайты могут быть двух размеров — 8x8 или 16x16 (переключаются сразу все спрайты) и дополнительно можно растянуть их (тоже сразу все) в два раза.<br/>
Всего спрайтов отображается одновременно на экране 32 (но не более 4 в одной строке). При этом 2кб памяти для Sprite patterns хватает на два набора по 32 спрайта 16x16.<br/>
<br/>
Индивидуально для каждого спрайта можно установить следующие параметры (через область Sprite attrubutes, для каждого байта в серии):<br/>
<br/>
<blockquote>0 — вертикальная координата (-32 — 191)<br/>
1 — горизонтальная координата (0-255). 255 — спрайт за правым краем экрана.<br/>
2 — указатель на место откуда брать паттерн (в Sprites patterns)<br/>
3 — биты 4-7 определяют цвет, бит 0 — early clock (сдвигает спрайт по горизонтали на 32 пиксела влево)</blockquote><br/>
Отсутствие прямой адресации видеопамяти в комбинации с неудачной её организацией и отсутствием в процессоре команд пересылки более чем байта за раз — не позволяет её быстро обновлять. К примеру, реализация горизонтального гладкого скроллинга области 256x8 пикселов при параллельном проигрывании VGM музыки почти полностью забирает время обратного хода луча по кадру. Т.е. больше времени почти ни на что не остаётся.<br/>
<br/>
В играх (современных) эта проблема решается довольно хитрыми способами, когда при скроллинге обновляется не вся скроллируемая область, а только требующая изменений. Соответственно, содержимое экрана продумывается таким образом, чтобы этих изменений был минимум. Также обычно используется Graphics Mode I с более низким цветовым разрешением (два цвета на блок 8x8).<br/>
<br/>
Как и во многих других системах, в TI-99/4a крайне желательно производить отрисовку изображения укладываясь в обратный ход луча по кадру (vertical retrace). Для этого VDP генерирует соответствующее прерывание — в начале рисования нижней части рамки.<br/>
<br/>
<a href="https://habrastorage.org/files/ac2/1be/b8c/ac21beb8ca7d4379ab571f672e564db1.jpg"></a> Существуют следующие варианты действий:<br/>
<br/>
1. Прерывания можно отключить полностью (инструкцией LIMI 0 + конкретно для VDP — установкой соответствующего бита в регистре 1). При этом всё будет побыстрее, но не получится отследить обратный ход луча никаким образом.<br/>
<br/>
2.Прерывания включить полностью (LIMI 2 и в VDP). Тогда можно повесить собственный обработчик прерываний, который будет что-нибудь делать.<br/>
<br/>
3.Включить прерывания в VDP, но отключить их инструкцией LIMI 0. В этом случае никакие обработчики вызываться не будут, но за обратным ходом луча можно следить вручную, проверяя бит в регистре состояния VDP (после чтения регистра этот бит автоматически сбрасывается. Если его не сбросить, то не сгенерится очередное прерывание).<br/>
<br/>
<pre><code>vwait:
          movb &gt;8802,r12 ; read VDP status register
          andi r12,&gt;8000
          jeq  vwait                ; Wait for vsync
</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
<br/>
Достаточно типична схема, когда прерывания от VDP включены, общие выключены (LIMI 0), но в основном цикле на короткий промежуток времени они включаются (LIMI 2), чтобы висящий на прерывании обработчик (например, играющий музыку) получал иногда управление.<br/>
<br/>
Не все эмуляторы правильно имитируют это прерывание. Но, скажем, MESS делает это более-менее адекватно. На картинке можно видеть простой тест — цвет рамки меняется с некоторой задержкой относительно vertical retrace (на настоящем TI и на двух эмуляторах — MESS и js99er).<br/>
<br/>
<h2>ЗВУК</h2><br/>
<h3>1. Стандартный звук</h3><br/>
Для получения музыки и звуковых эффектов в TI-99/4a установлен чип TMS9919 (аналоги: SN76489, SN76496). Он довольно прост: три независимых генератора тона и один — шума. 15 уровней громкости.<br/>
<br/>
Поскольку это довольно популярный чип (использовался в некоторых консолях, в IBM PCjr/Tandy-1000 и пр.), информации по нему много.<br/>
<br/>
Для TI-99/4a существует трэкер MOD2PSG (нормально запускается под Win7 64bit). В частности, он позволяет загружать файлы формата psgmod и экспортировать vgm и epsgmod.<br/>
<br/>
Имеется два работающих плеера — EPSGMOD Player by Tursi ( требует данные в формате epsgmod, вешает свой обработчик на прерывание VDP).<br/>
<br/>
Подключается он следующим образом:<br/>
<br/>
<pre><code>        def  start


start:
        lwpi &gt;8320

        li  r0,musicdata
        bl  @SGPLAY

again:

        limi    2
        limi    0

; .... your code (vsync etc..) ...

        b    @again

musicdata:
        bcopy   "music.epsgmod"

        copy    "test_music_playervbr.a99"
        copy    "test_music_player.a99"

        end    start
</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
При таком подключении плеера, необходимо из его исходников убрать REF и END (поскольку они ориентированы на использование с традиционными ассемблером).<br/>
<br/>
Обратите внимание, что в основном цикле на мгновение включаются прерывания (limi 2). Это необходимо для работы плеера, который работает по прерываниям VDP от обратного хода луча (происходящим каждую 1/60 секунды). При этом вызывается подпрограмма SGTICK плеера.<br/>
<br/>
Соответственно важно, что для NTSC версии компьютера и музыка должна быть тоже NTSC (частота кадров должна совпадать).<br/>
<br/>
Второй плеер (того же автора) проигрывает файлы формата VGM (включает также утилиту VGMComp для сжатия VGM). Этот свой обработчик не вешает, нужно вызывать вручную с частотой 60Гц.<br/>
<br/>
Выглядит это так:<br/>
<br/>
<pre><code>          def  start

vdpsta    equ  &gt;8802               ; VDP RAM status

start:
          limi 0

          lwpi ws0               ; player expects our workspace to be &gt;8300

          clr  r2
          li   r1,musicdata
          bl   @stinit

again:

          clr  r12                 ; set CRU base (doesn't need to be in loop, but provides delay)
          tb   2                   ; check VDP interrupt input (Tests a CRU bit)
          jeq  loop                ; if not set, skip calling music
          movb @vdpsta,r12         ; read status register, which in turn clears the interrupt bit
          bl   @stplay             ; call play function - it returns with the wrong workspace

* check for song end

          movb @songwp+14,r3
          jne  notdone

          clr  r2                   ; play again
          li   r1,musicdata
          bl   @stinit

notdone:
          lwpi &gt;8300               ; so restore the right one


; .... your code (vsync etc..) ...

          b    @again

musicdata:

          bcopy  "music.vgm"
          copy   "tiplayer.a99"

          end    start
</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
На мой взгляд, у второго варианта плеера лучше качество (хотя, это может зависеть от конкретной музыки) и ручной вызов гибче, чем обработчик (который вы и сами можете навесить, если очень надо) — не нужно включать прерывания.<br/>
<br/>
Также у него есть вариант плеера на 30гц. При этом вызывать его нужно тоже с частотой 60гц, но использовать он будет каждый второй вызов. Соответственно, снижается загрузка процессора, но потенциально может упасть качество звучания музыки (зависит от используемых в ней эффектов).<br/>
<br/>
По-видимому, в плеере (либо при экспорте в VGM) присутствует баг, создающий непонятные проблемы с зацикливанием музыки.<br/>
<br/>
<h3>2. Синтезатор речи</h3><br/>
 Поскольку синтезатор речи является очень популярным периферийным устройством для TI-99/4a, довольно много программ его используют. Синтезатор присоединяется к порту в правой части компьютера (при наличии NanoPEB его можно воткнуть прямо в синтезатор). Внутри находится ПЗУ со данными для слов, LPC декодер (TMS5220) и ЦАП.<br/>
<br/>
Имеется два режима работы. В первом компьютер указывает синтезатору, какие слова из ПЗУ следует произносить (слов там немного). Во втором (Speak-External) есть возможность передавать непосредственно сжатые LPC данные, которые синтезатор просто будет воспроизводить. Для упаковки данных используется древняя программа QBox Pro, которая запускается под WinXP (процесс показан <a href="https://www.youtube.com/watch?v=wVDE-6TtmFQ">здесь</a>).<br/>
<br/>
Синтезатором можно управлять непосредственно из программы на ассемблере. Если же хочется просто поиграться, то необходим картридж — например, Speech Editor (позволяет проговаривать набранный текст, а также добавляет в стандартный Бейсик команды для воспроизведения слов). Картридж Terminal Emulator позволяет произносить отдельные фонемы и соединять их в произвольные слова.<br/>
<br/>
В наиболее известных эмуляторах синтезатор поддерживается. Считается, что наилучшая поддержка (полностью эмулируется железка) реализована в MESS/MAME.<br/>
<br/>
Ниже пример, который произносит слово «HELLO» беря LPC данные из ПЗУ синтезатора. Документация указывает, что проверка статуса невозможна, если код выполняется в ОЗУ на 8 битной шине (т.е. требуется чтобы код находился в 16 битном scratchpad), однако после проверки на эмуляторах и реальном компьютере я считаю, что это перестраховка (вероятно, как и в случае с VDP, все эти требования относятся к каким-то совсем ранним версиям железа). Получился вот такой короткий код:<br/>
<br/>
<pre><code>; speaks 'HELLO' from speech synth ROM

    def  start

SPCHRD  equ  &gt;9000       ; addr to read from synth
SPCHWT  equ  &gt;9400       ; addr to write to synth   (&gt;10 - read, &gt;4x - Load-Address, &gt;50 - speak, &gt;60 = speak-ext )

H50   BYTE  &gt;50      ; speak command

start:
    limi  0

; loading speech address (5 nibbles of data required) using &gt;4x Load-Address command
; &gt;4x &gt;4x &gt;4x &gt;4x &gt;40 (end marker &gt;0)


    li    r0,&gt;351a ; address of 'HELLO' in synth ROM
    li    r2,4    ; 4 nibbles
loadlp:
    src   r0,4    ; start with least significant nibble
    mov   r0,r1
    src   r1,4
    andi  r1,&gt;0f00 ; get only particular nibble
    ori   r1,&gt;4000 ; put in &gt;4x00 format
    movb  r1,@SPCHWT  ; write nibble
    dec   r2
    jne   loadlp
    li    r1,&gt;4000
    movb  r1,@SPCHWT  ; write fifth nibble (end marker)

    movb  @H50,@SPCHWT  ; execute speak command

loopback:
    b     @loopback
    end   start
</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Адреса всех слов из ПЗУ можно найти в книжке Editor Assembler Manual.<br/>
<br/>
Если нужно воспроизвести произвольную речь преобразованную в LPC при помощи QBox Pro, то в самом простом случае код будет выглядеть так:<br/>
<br/>
<pre><code>  def  SPEAK

SPEAK
  li   r2,1750    ; number of speech BYTEs to poke (see end of QBox data)
  li   r3,speech  ; speech data address

  limi 0      ; no interrupts

loop
  movb *r3+,@&gt;9400 ; poke a  BYTE of speech data
  dec  r2
  jeq  quit     ; repeat until end of data

  jmp  loop ; else go 'round again


quit
  limi 2 ; interrupts allowed
  rt

speech


; 10 Voiced 4 Unvoiced 8 kHz 5220
; [Coded LPC]

; .... данные из *.sfm полученном при помощи QBox Pro

; nb bytes: [1750]

 end
</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Для QBox Pro нужно подготовить wav файл с речью. Лучше всего будет звучать чёткая мужская речь. Одна фраза будет занимать около килобайта. <br/>
<br/>
Передать пение или ноты — не выйдет. После кодирования в LPC подобные звуки будут совершенно неузнаваемы.<br/>
<br/>
Настройки и операции в QBox Pro:<br/>
<br/>
<pre><code>byte
8khz
5220

Project/Add files
select file

Process/Medium bit rate /OK
Edit/Concatenations
Insert/Concatenation/Concat Name/ "TEST"
Insert/Phrase/OK
Format/LPC 10V, 4UV      /OK
Project/Exit/Save
</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Результат: test.sfm<br/>
<br/>
<h2>КРОСС-СРЕДСТВА</h2><br/>
Чтобы разрабатывать и тестировать программы на PC, а затем загружать их на TI-99/4a, понадобится следующее:<br/>
<br/>
Железо:<br/>
<br/>
 — PC/Win7 (64bit годится)<br/>
 — TI-99/4a<br/>
 — Картридж Editor/Assembler (или любой другой, позволяющий загружать и запускать программы в машинных кодах)<br/>
 — NanoPEB или CF7+ (для эмуляции дисковода и загрузки программы с CompactFlash карты в TI-99/4a)<br/>
<br/>
Софт:<br/>
<br/>
 — Один из многочисленных эмуляторов TI-99/4a — MESS/MAME или js99er (а лучше несколько).<br/>
 — Пакет xdt99, включающий ассемблер и утилиты для работы с файлами и образами дисков (в частности, xvm99 для записи образа диска на CompactFlash карту, в нужном для NanoPEB формате)<br/>
<br/>
Организация процесса:<br/>
<br/>
Программы для картриджа и для загрузки с диска — разные вещи. Не только по формату (RPK и DSK) но и в плане работы с памятью (второй вариант подрузамевает расширение памяти 32кб). Если есть цель в итоге запустить код на реальной машине, ориентироваться надо на дисковую версию. Её и рассмотрим.<br/>
<br/>
Эмуляторы существенно отличаются друг от друга, лучший назвать очень сложно. Это не только вопрос качества эмуляции, но и удобства/простоты запуска готовой программы.<br/>
Наиболее известные: mess(mame), js99er, v9t9, classic99.<br/>
<br/>
Все они не идеальны. Вполне можно ожидать 10% разницы в скорости между эмулятором и реальной железкой (конкретно я наблюдал, что mess и js99er чуть быстрее выполняют весь код чем реальный TI. В одном и том же NTSC)<br/>
<br/>
При использовании в качестве ассемблера xdt99 процесс выглядит так:<br/>
<br/>
<pre><code>xas99.py -R --jumpstart %1.a99   (получаем объектный файл)</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Параметр -R позволяет нормально именовать регистры в исходном тексте (r0, r1, ...). В традиционном ассемблере TMS9900 регистры в командах записываются просто цифрами, что вносит дикую путаницу.<br/>
<br/>
<pre><code>xdm99.py work.dsk -a %1.obj -n %1-O -f DIS/FIX80  (помещаем полученный объектный файл на образ диска)</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Нужно учитывать, что объектный файл представляет собой текстовый файл с шестнадцатиричными кодами внутри. Хотя это не конечный бинарный файл, тем не менее из-за особенностей загрузки программ на TI-99/4a (через Editor/Assembler) его часто считают готовой программой. Тем более удобно, что он обычно не привязан к конкретной области памяти при загрузке.<br/>
<br/>
Если требуется именно конечный бинарный файл, для xas99 следует добавить параметр "-i". Загружать его тогда нужно будет не через пункт 3, а через пункт 5 в Editor/Assembler. Если нужен конечный бинарный файл более 8к, без разбиения на отдельные части, вместо -i нужно использовать -b.<br/>
<br/>
Дополнительно можно получить файл листинга .lst указав параметр "-L".<br/>
<br/>
Несколько упрощает работу специальный образ картриджа для автоматической загрузки (см. «jumpstarting» в документации на xdt99). Образ позволяет в эмуляторе обойтись без Editor/Assembler, нажатия в нём кнопок и ввода имени файла. Готовый код загружается с диска автоматически при выборе картриджа. К примеру mess(mame) в этом случае запускается так:<br/>
<br/>
<pre><code>mame64.exe ti99_4a -peb:slot8 tifdc -peb:slot2 speech -flop1 %1.dsk -cart jumpstart.rpk -window -ui_active -skip_gameinfo</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Если нужен отладчик, можно ещё добавить -debug (вход в отладчик из эмулятора при условии, что была указана опция — клавишей ` )<br/>
<br/>
Параметр «ti99_4a» подрузамевает NTSC версию компьютера (т.е. наиболее распространённую). Для PAL версии это будет ti99_4ae.<br/>
Отличие очень существенное, как минимум из-за разной частоты кадров -. в первом случае кадровая 60гц, во втором 50гц. Неправильный выбор может привести, например, к замедленному проигрыванию музыки (если она писалась под NTSC, а выбран PAL).<br/>
<br/>
Если разрабатываемое приложение имеет существенный размер или что-то считает ощутимое время, можно ускорить эмуляцию параметром -speed 20<br/>
<br/>
Для переноса записи программы на CompactFlash в формате NanoPEB можно использовать xvm99.py <br/>
<br/>
<pre><code>\\.\PHYSICALDRIVE2 1 -w work.dsk</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Убедитесь, что на вашем компьютере PHYSICALDRIVE2 соответствует именно устройству в которое вставлен CF (иначе можете испортить данные на своих дисках!). В Windows это можно посмотреть командой<br/>
<br/>
<pre><code>wmic diskdrive list brief /format:list</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
Поскольку на одном CF может быть несколько образов для эмуляции нескольких дисководов, второй параметр соответствует дисководу — т.е. DSK1 для 1).<br/>
<br/>
Предварительно CF рекомендуется отформатировать под FAT16, после чего обязательно на самом TI со вставленным NanoPEB из TI Basic набрать «call format(1)», где 1 — номер форматируемого виртуального дисковода.<br/>
<br/>
Просмотр содержимого флэшки:<br/>
<br/>
<pre><code>xvm99.py \\.\PHYSICALDRIVE2 1 -i</code><div class="code-explainer"><a href="https://sourcecraft.dev/" class="tm-button code-explainer__link" style="visibility: hidden;"></a></div></pre><br/>
При загрузке программы на самом TI нужно вставить картридж с Editor/Assembler и NanoPEB. Включить NanoPEB, затем компьютер. В меню выбрать опцию «2» — «Editor/Assembler», в нём пункт 3 (либо 5), набрать DSK1.ИМЯ_ФАЙЛА и нажать ENTER.<br/>
Регистр в имени файла важен.<br/>
<br/>
<h2>ПРИЛОЖЕНИЕ 1 — интро 99TRO</h2><br/>
В процессе изучения TI-99/4a мной была написана <a href="http://www.youtube.com/watch?v=NR0YOCODR7g">«99tro»</a> <a href="https://github.com/petersobolev/99tro">(исходник)</a> — небольшая invitation intro на Chaos Constructions'2016, представленная на Revision'2016. Дополнительно к её исходникам (код весьма ужасен — не пишите так!) здесь будут даны некоторые пояснения.<br/>
<br/>
Основная идея в том, чтобы интро по возможности передавало стилистику старых cracktro для Commodore 64, естественно с поправкой на более скромные возможности видео и звукового чипов TI-99/4a. Грубо говоря, хотелось что-то типа цветного логотипа, плавно скроллящейся текстовой строки, переливающихся цветных полосок и болтающейся надписи из спрайтов.<br/>
<br/>
<a href="https://habrastorage.org/files/3fc/620/0dd/3fc6200ddc874e0888ef15dccb204b8f.jpg"></a> Вскоре стали ясны следующие существенные ограничения и недостатки компьютера:<br/>
<br/>
 — Аппаратного скроллинга нет, его можно сделать только сдвигами и перезаписью видеопамяти<br/>
<br/>
 — Обмен с видеопамятью (это касается и спрайтов и графики и текста) очень медленный и сравнительно высокая частота процессора не спасает (равно как и его 16-разрядность, т.к. обмен с VDP идёт по 8-разрядной шине).<br/>
<br/>
 — VDP имеет ряд недокументированных или невнятно документированных багов (что неудивительно, TMS9918 — один из первых специализированных видеочипов). Пару раз это приводило к тому, что от уже практически законченной части приходилось отказываться.<br/>
<br/>
 — Сильно ограниченный функционал спрайтов — только 4 в строчку (что автоматически означает, что ничего шириной в экран спрайтами не сделаешь), одноцветность, большое количество инструкций процессора для простой смены цвета или координаты спрайта.<br/>
<br/>
 — Проигрывание музыки (vgm) отнимает весьма существенное время процессора. Как заявлено в исходниках плеера от Tursi, это 2-20% для 30гц версии, взависимости от конкретной музыки. В моём конкретном случае получалось не меньше 10-15%.<br/>
<br/>
 — Беда с удобными отладчиками (на самом деле, та же картина была и с эмулятором Vectrex — в обоих случаях есть мощные отладчики, но неудобные настолько, что, по факту, их использование скорее замедляет работу, нежели ускоряет)<br/>
<br/>
 — Невозможность быстро проверить код на реальном железе. Для этого нужно всё выключить, вытащить флэшку, воткнуть в PC, скопировать на неё код, вытащить из PC и вставить в TI, включить эмулятор диска и сам TI, выбрать Editor/Assembler, выбрать пункт загрузки программы, набрать DSK1.имя_программы, нажать ENTER, дождаться загрузки (около минуты).<br/>
<br/>
В итоге постепенно от прежних идей осталось только то, что позволяла реализовать железка (конечно, с учётом, что это была моя первая программа для этой платформы и этого процессора):<br/>
<br/>
 — Надпись/лого CHAOS CONSTRUCTIONS'2016 с головой робота<br/>
 — Мигающие в такт музыке глаза и рот робота<br/>
 — Появляющийся буква за буквой, вслед за пульсирующим курсором, текст в несколько строк<br/>
 — Плавно скроллящаяся строка текста<br/>
 — Фоновая музыка (vgm)<br/>
<br/>
Чтобы хоть как-то использовать сильные стороны TI-99/4a, я выбрал режим с максимальным графическим и цветовым разрешением — Graphics mode II (Bitmap). Для игр его используют крайне редко, т.к. он требует всех 16кб видеопамяти и, соответственно, очень медленный с точки зрения обновления изображения.<br/>
<br/>
Однако, в отличие от игр, в моём случае можно было пойти на хитрость (что вообще характерно для demo и intro) — цвета я динамически не обновлял вообще нигде. Всё, что касается цветов, было установлено единственный раз в начале, вне основного цикла.<br/>
В цикле же менялся только bitmap и переключались два спрайта.<br/>
<br/>
Верхнее лого было нарисовано сначала в Photoshop, затем преобразовано в дамп видеопамяти для VDP при помощи утилиты Convert9918 и далее эти два этапа циклически повторялись — т.е. в исходную картинку вносились уточнения, чтобы после преобразования (в 15-ти довольно кривых цветах и цветовом разрешении 2 цвета на 8 горизонтальных пикселов) она выглядела максимально адекватно. Надо сказать, что искажения характерные для композитного NTSC сигнала сыграли, как часто в таких случаях бывает, на руку — на CRT мониторе картинка выглядит явно лучше, чем в эмуляторе (к тому же, теплее и ламповее).<br/>
<br/>
Надо сказать, я впервые всерьёз осознал, насколько важен для успеха платформы правильный выбор 16 возможных цветов её (платформы) разработчиками. В случае с TI-99/4a эти цвета крайне неудачны (к тому же, их 15).<br/>
<br/>
Кроме того, впервые пришлось столкнуться с проблемой кодирования цвета в NTSC видеосигнале. На фото видно, во что превращаются цвета для одиночных пикселов (в PAL это тоже вызывает проблемы, но несопоставимо меньшие).<br/>
<br/>
Нижний плавный скроллинг был взят из единственного подобного примера (Matthew Hagerty) и модифицирован. Честно говоря. я бы за столь короткий срок вряд ли смог проникнуться ассемблером TMS9900 достаточно глубоко, чтобы повторить некоторые использованные там приёмы, без которых просто не хватило бы общей производительности для всей работы.<br/>
<br/>
В скроллинге достаточно хитро сдвигаются влево части символов и результат копируется в VRAM. Всего скроллится область в 8 пикселов высотой.<br/>
<br/>
Как я уже сказал выше, операции производятся исключительно над bitmap'ом — цветной фон в виде бело-синей полосы нарисован заранее и скроллингом не затрагивается.<br/>
<br/>
Поскольку скроллинг — наиболее затратная операция в основном цикле, всё дальнейшее отталкивалось от него и от музыки (если перестаёшь укладываться в обратный ход луча, музыка начнёт тормозить).<br/>
<br/>
К сожалению, по факту она всё равно немного тормозит т.к. оба эмулятора, на которых я отлаживал код, работали чуть быстрее, чем реальная железка. В чём именно заключается проблема — неясно.<br/>
<br/>
В средней части экрана пишется текст за курсором. У меня было много идей как это красиво реализовать, но в итоге от всех пришлось отказаться из-за медленной видеопамяти и багов VDP. В результате, за каждую итерацию цикла рисуется одна буква (т.е. обновляется 8 байт видеопамяти). Для всех возможных восьми строк текста заранее установлен фон с плавным переходом между оттенками синего и серым.<br/>
<br/>
Пульсирующий курсор представляет собой спрайт, для которого изображение берётся циклически из четырёх мест памяти — т.е. получается четыре кадра квадратика разного размера.<br/>
<br/>
Что касается мигающих глаз и рта робота, то они реализованы тремя кадрами одного спрайта 16x16 (опять же — с целью выгадать в производительности). Тот или иной кадр выбирается взависимости от громкости одного из каналов звукового чипа (эти данные возвращает плеер).<br/>
<br/>
Спрайты и шрифты редактировались в программе Magellan.<br/>
<br/>
В коде используется три разных workspace для регистров процессора — одно для плеера (а он требует себе не только workspace, но и ещё кусок scratchpad — ценной 16-разрядной RAM, из-за чего не удалось увеличить скорость выполнения кода переносом его частей туда), второе для скроллинга и третье для всего остального (счётчики в цикле, координаты курсора и пр.)<br/>
<br/>
В итоге суммарный размер intro получился в районе 22кб. Основная часть, конечно, это несжатая графика (12kb) и RLE сжатая музыка (1.8кб). Таким образом, сам код занимает где-то в районе 6-7кб (да и то там есть фрагменты, которые использовались лишь для отладки).<br/>
<br/>
<h2>ПРИЛОЖЕНИЕ 2 — интро Speechtro</h2><br/>
Однокилобайтное интро под названием <a href="https://www.youtube.com/watch?v=JJneJzWwd7U">«Speechtro»</a> <a href="https://github.com/petersobolev/speechtro">(исходник)</a> было написано вскоре после 99tro и представлено на DIHALT'2016 (где заняло первое место в 1kb low end intro).<br/>
<br/>
В основе были две идеи:<br/>
<br/>
<strong>1.</strong> Сделать что-то, использующее синтезатор речи (среди владельцев TI-99/4a он весьма распространён, а также хорошо поддержан эмуляторами — MESS/MAME и js99er).<br/>
<strong>2.</strong> Попытаться изобразить визуально большое число цветов с имитацией растровых эффектов.<br/>
<br/>
После некоторых колебаний было решено обе идеи объединить в одну работу.<br/>
<br/>
Речь использует слова прошитые в ПЗУ синтезатора (так как в случае с прямым LPC сжатием в 1кб столько речи не влезло бы). Поскольку их в ПЗУ весьма немного, ушло порядочно времени, чтобы составить из имеющихся слов связную речь на подходящую тему. К сожалению паузы в словаре синтезатора не предусмотрено. В качестве паузы я использовал довольно случайный адрес, данные с которого звучат как «бульканье». Это, во-первых, экономит и упрощает код, во-вторых звучит интереснее, чем просто тишина.<br/>
<br/>
Что касается изображения, то первоначально хотелось попробовать реализовать растровые эффекты (меняя цвет фона в момент, когда луч идёт по нужной строке). Это оказалось технически невозможным (на скриншотах выше можно видеть попытки сделать это на настоящем TI и на эмуляторах — MESS и js99er), поэтому был выбран другой вариант — имитировать растровые эффекты через манипуляции с памятью атрибутов. В Graphics Mode 2 каждый блок 8x1 может иметь независимый цвет фона и цвет изображения, поэтому каждая полоска высотой в 1 пиксел может иметь разные цвета для фона и текста. Несмотря на то, что цветов всего 15 (а в полосках используется лишь 10), создаётся впечатление, что их гораздо больше.<br/>
<br/>
Отдельные трудности вызвал вывод текста. Особенности конструкции TI-99/4a таковы, что ПЗУ (так называемый GROM) не отображается в адресное пространство процессора, поэтому данные для вывода шрифта извлекаются из GROM только последовательно (побайтно) — заданием начального адреса и чтением одной и той же ячейки памяти.<br/>
Выбранный набор «small caps» имеет только буквы A-Z (без цифр), что несложно заметить.<br/>
<br/>
Звёзды, как и ползущий наискосок баг, реализованы спрайтами 8x8. <br/>
В процессе проговаривания слов в двух линейках квадратиков отображается (условно) часть адреса текущего слова в ПЗУ синтезатора.<br/>
<br/>
<h2>ССЫЛКИ НА РЕСУРСЫ ПО TI-99/4a</h2><br/>
<ul>
<li><a href="https://www.youtube.com/watch?v=-f0_5YI65i4">Мой семинар на CC'2016: «Компьютер 'Texas Instruments TI-99/4a' 1980 года и разработка под него»</a></li>
<li><a href="http://www.unige.ch/medecine/nouspikel/ti99/titechpages.htm">Основной ресурс по железу TI-99/4a</a></li>
<li><a href="http://atariage.com/forums/forum/119-ti-994a-development">Основной форум по разработке для TI-99/4a</a></li>
<li><a href="https://computerarchive.org/files/mirror/ftp.whtech.com/">Различный софт, журналы и т.д.</a></li>
<li><a href="http://endlos99.github.io/xdt99/">Лучший кросс-ассемблер и утилиты к нему</a></li>
<li><a href="http://webpages.charter.net/nanopeb/">NanoPEB (CF7+)</a></li>
<li><a href="http://atariage.com/forums/topic/250540-flash-rom-cart/">Эмулятор картриджа (альтернатива NanoPEB)</a></li>
<li><a href="http://enlight.ru/files/ti99docs.zip">Полезная документация и книги, одним архивом</a></li>
<li><a href="http://atariage.com/forums/topic/218904-playground/">Запуск маленьких программ в кодах внутри scratchpad (без Editor/Assembler и без расширения памяти)</a></li>
<li><a href="http://js99er.net">Хороший эмулятор на js</a></li>
<li><a href="http://www.cs1er.com/">Работа с кассетником</a></li>
<li><a href="http://www.harmlesslion.com/cgi-bin/showprog.cgi?TI994A">Полезный софт</a></li>
<li><a href="http://spectra99.sourceforge.net/">Библиотека для разработки игр</a></li>
</ul><br/>
<a href="http://enlight.ru/roi/">Здесь</a> можно посмотреть мои работы под разные ретро-платформы, а <a href="https://github.com/petersobolev">здесь</a> их исходники на github.<br/>
<br/>
Пользуясь случаем, хочу также пригласить всех интересующихся на фестиваль <a href="http://chaosconstructions.ru/">Chaos Constructions</a>, который мы ежегодно (с прошлого века) проводим в Питере в конце августа, и где можно потрогать разные ретро-компьютеры живьём.<br/>
<br/>
P.S. За железку спасибо Кириллу Тимофееву и Тимуру Ташпулатову</div></div></div><!----><!----></div><!----><!----></div><!--]--><!----><div class="tm-article-presenter__meta" data-test-id="article-meta-links"><div class="tm-separated-list tag-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[ti-99/4a]" class="link"><span>ti-99/4a</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[texas+instruments]" class="link"><span>texas instruments</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[tms9900]" class="link"><span>tms9900</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D1%80%D0%B5%D1%82%D1%80%D0%BE-%D0%BA%D0%BE%D0%BC%D0%BF%D1%8C%D1%8E%D1%82%D0%B5%D1%80%D1%8B]" class="link"><span>ретро-компьютеры</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[intro]" class="link"><span>intro</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[demoscene]" class="link"><span>demoscene</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%B0%D1%81%D1%81%D0%B5%D0%BC%D0%B1%D0%BB%D0%B5%D1%80]" class="link"><span>ассемблер</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%B8%D0%BD%D1%82%D1%80%D0%BE]" class="link"><span>интро</span></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%B4%D0%B5%D0%BC%D0%BE%D1%81%D1%86%D0%B5%D0%BD%D0%B0]" class="link"><span>демосцена</span></a><!--]--></li><!--]--><!----></ul></div><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span><ul class="tm-separated-list__list"><!--[--><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/assembler/" class="link"><!--[--><span>Assembler</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/demoscene/" class="link"><!--[--><span>Демосцена</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/crazydev/" class="link"><!--[--><span>Ненормальное программирование</span><!--]--></a><!--]--></li><li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/antikvariat/" class="link"><!--[--><span>Старое железо</span><!--]--></a><!--]--></li><!--]--><!----></ul></div></div><!----><!--]--></article><!--]--></div><!----></div><div style="" class="tm-article-sticky-panel" data-test-id="article-sticky-panel"><div class="tm-data-icons tm-data-icons tm-data-icons_space-big tm-article-sticky-panel__icons" data-test-id="article-stats-icons"><div class="article-rating tm-data-icons__item" data-v-b9b05a90><div class="tm-votes-meter votes-switcher" data-v-b9b05a90><svg class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon tm-votes-meter__icon_appearance-article" height="24" width="24"><title>Всего голосов 42: ↑42 и ↓0</title><use xlink:href="/img/megazord-v28.cba4c116..svg#counter-rating"></use></svg><span class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating tm-votes-meter__value" data-test-id="votes-meter-value" title="Всего голосов 42: ↑42 и ↓0">+40</span></div><!--teleport start--><!--teleport end--><!----></div><!----><!----><button class="bookmarks-button tm-data-icons__item" title="Добавить в закладки" type="button" data-v-861e2740><span class="tm-svg-icon__wrapper icon" data-v-861e2740><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title><use xlink:href="/img/megazord-v28.cba4c116..svg#counter-favorite"></use></svg></span><span class="counter" title="Количество пользователей, добавивших публикацию в закладки" data-v-861e2740>43</span></button><div class="sharing tm-data-icons__item" title="Поделиться" data-v-daf6ee1d><button class="sharing-button" type="button" data-v-daf6ee1d><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="icon" data-v-daf6ee1d><path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path></svg></button><!--teleport start--><!--teleport end--></div><div class="article-comments-counter-link-wrapper tm-data-icons__item" title="Читать комментарии" data-v-8d952463><a href="/ru/articles/313058/comments/" class="article-comments-counter-link" data-test-id="counter-comments" data-v-8d952463><!--[--><svg class="tm-svg-img icon" height="24" width="24" data-v-8d952463><title>Комментарии</title><use xlink:href="/img/megazord-v28.cba4c116..svg#counter-comments"></use></svg><span class="value" data-v-8d952463>11</span><!--]--></a><!----></div><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--teleport start--><!--teleport end--><!----></div></div></div><!--[--><!--]--><div class="tm-article-presenter__footer"><!--[--><!--[--><div class="tm-article-blocks"><!----><!--[--><section class="tm-block tm-block tm-block_spacing-bottom"><!----><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-balanced"><!--[--><div class="article-author" data-test-id="article-author-info" data-async-called="true" data-v-af0d0f90><!--[--><!--]--><div class="tm-user-card tm-user-card tm-user-card_variant-article user-card" data-async-called="true" data-v-af0d0f90><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/frog/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><!--[--><div class="tm-entity-image"></div><!--]--></a><div class="tm-user-card__meta"><div class="tm-counter-container karma" title=" 155 голосов " data-v-544d285f><div class="tm-counter-container__header"><!--[--><div class="karma-display positive" data-v-544d285f data-v-3881f4ba>143</div><!----><!--]--></div><div class="tm-counter-container__footer"><!--[--><div class="karma-text" data-v-544d285f>Карма</div><!--teleport start--><!--teleport end--><!--]--></div></div><div class="tm-counter-container"><div class="tm-counter-container__header"><!--[--><!--[--><!--]--><div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!----><div class="tm-votes-lever__score tm-votes-lever__score_appearance-rating tm-votes-lever__score" data-test-id="lever-score"><!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_rating tm-votes-lever__score-counter" data-test-id="votes-score-counter">0</span></span><!--]--></div><!----></div><!--]--></div><div class="tm-counter-container__footer"><!--[--><span class="tm-rating__text tm-rating__text">Общий рейтинг</span><!--]--></div></div></div></div></div><div class="tm-user-card__info tm-user-card__info_variant-article tm-user-card__info"><div class="tm-user-card__title tm-user-card__title_variant-article tm-user-card__title"><span class="tm-user-card__name tm-user-card__name_variant-article tm-user-card__name">Пётр Соболев</span><a href="/ru/users/frog/" class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article"><!--[-->@frog<!--]--></a><!----></div><p class="tm-user-card__short-info tm-user-card__short-info_variant-article tm-user-card__short-info" data-test-id="user-card-speciality">Пользователь</p></div></div><!----><div class="tm-user-card__buttons tm-user-card__buttons_variant-article tm-user-card__buttons"><!----><div class="tm-user-card__button"><div class="tm-button-follow tm-user-card__button-follow"><!----><button class="tm-button-follow__button tm-button-follow__button_big" data-test-id="follow-button" type="button">Подписаться</button></div></div><!----><!--[--><div class="tm-user-card__button tm-user-card__button_write" data-test-id="user-card-conversations"><svg class="tm-svg-img tm-user-card__button-icon" height="16" width="16"><title>Отправить сообщение</title><use xlink:href="/img/megazord-v28.cba4c116..svg#mail"></use></svg></div><!--]--><!----><!----></div><!----></div><div class="author-contacts" data-test-id="author-contacts" data-v-af0d0f90><!----><!----><!----></div></div><!--]--></div><!--]--><!----></section><!----><!--[--><div class="sponsor-block" style="--d75346b8:0;--11dbf66e:100%;" data-v-580b3119><div class="title" data-v-580b3119>Хабр доступен 24/7 благодаря поддержке друзей</div><div class="content-container" data-v-580b3119><div class="content" data-v-580b3119><div class="content-title-container" data-v-580b3119><div class="content-title" data-v-580b3119>Хабр Курсы для всех</div><div class="sponsor-mark" data-v-580b3119>РЕКЛАМА</div></div><div class="content-text" data-v-580b3119> Практикум, Хекслет, SkyPro, авторские курсы — собрали всех и попросили скидки. Осталось выбрать! </div><a class="content-action" href="https://career.habr.com/courses/?erid=2VSb5wDLYUH&amp;utm_source=habr&amp;utm_medium=sponsorship_hub" target="_blank" data-v-580b3119><button class="btn btn_solid btn_small tm-button_color-horizon" tabindex="0" type="button" data-v-580b3119><!--[--><!--[-->Перейти<!--]--><!--]--></button></a></div></div><div class="footer" data-v-580b3119><!----></div><!----></div><!--]--><!--]--><div class="tm-article-blocks__comments"><div id="publication-comments" class="tm-article-page-comments"><div><!--[--><div class="article-comments-counter-link-wrapper tm-article-comments-counter-button" data-v-8d952463><a href="/ru/articles/313058/comments/" class="article-comments-counter-link button-style" data-test-id="counter-comments" data-v-8d952463><!--[--><svg class="tm-svg-img icon icon--contrasted" height="24" width="24" data-v-8d952463><title>Комментарии</title><use xlink:href="/img/megazord-v28.cba4c116..svg#counter-comments"></use></svg><span class="value value--contrasted" data-v-8d952463> Комментарии 11 </span><!--]--></a><!----></div><!--]--></div></div></div><!--[--><!--[--><!--]--><section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header tm-block__header_variant-borderless"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2><!--[--><!--]--></div><!----></header><!--[--><div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim"><!--[--><!--[--><div class="tabs" data-test-id="container" data-v-681e7545><div class="" data-test-id="scroll-area" data-v-681e7545><!--[--><span class="tab-item" data-v-681e7545><button class="active slim tab-link" data-v-681e7545>Лучшие за сутки</button></span><span class="tab-item" data-v-681e7545><button class="slim tab-link" data-v-681e7545>Похожие</button></span><!--]--></div><!----></div><div class="similar-and-daily__tab-view"><div class="daily-articles-list"><ul class="article-card-list" data-v-7f7081d6><!--[--><!--]--><div class="tm-bordered-card" data-v-7f7081d6><!----><!--[--><!--]--></div></ul><div class="daily-articles-block__button-container"><button class="btn btn_transparent btn_small tm-button_color-horizon" tabindex="0" type="button"><!--[--><!--[-->Показать лучшие за всё время<!--]--><!--]--></button></div></div><!----></div><!--]--><!--]--></div><!--]--><!----></section><!--[--><div><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-promo"><div class="tm-placeholder-promo__header"><div class="tm-placeholder__line tm-placeholder__line_promo-title"></div></div><div class="tm-placeholder-promo__body"><div class="tm-placeholder-promo__posts"><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div><div class="tm-placeholder-promo__post"><div class="tm-placeholder-promo__image"></div><div class="tm-placeholder__line tm-placeholder__line_post-title"></div></div></div><div class="tm-placeholder-promo__dots"><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div><div class="tm-placeholder-promo__dot"></div></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div></div><div class="placeholder-wrapper"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><div class="tm-placeholder-inset tm-placeholder-vacancies"><div class="tm-placeholder-inset__header"><div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div></div><div class="tm-placeholder-inset__body"><ul class="tm-placeholder-list"><!--[--><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div><div class="tm-project-block-items__properties"><!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]--></div></li><!--]--></ul></div><div class="tm-placeholder-inset__footer"><div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div></div></div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></div><!--]--><!----><!--[--><!--]--><!--]--></div><!----><!--]--><!--]--></div></div><!--]--></div><!--]--></div></div><div class="tm-page__sidebar"><!--[--><div class="sidebar" data-v-0050f56d><div id="sidebar-window-placement" data-v-0050f56d></div><!--[--><!--]--></div><!--]--></div></div><!--]--></div><!----></div></main><!----></div><div class="tm-footer-menu"><div class="tm-page-width"><!--[--><div class="tm-footer-menu__container"><!--[--><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Ваш аккаунт</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/articles/313058/&amp;hl=ru" rel="nofollow" target="_self">Войти</a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/articles/313058/&amp;hl=ru" rel="nofollow" target="_self">Регистрация</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Разделы</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/ru/articles/" class="footer-menu__item-link">Статьи</a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">Новости</a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">Хабы</a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">Компании</a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">Авторы</a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">Песочница</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Информация</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">Устройство сайта</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">Для авторов</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">Для компаний</a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">Документы</a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement/?hl=ru_RU" target="_blank">Соглашение</a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/?hl=ru_RU" target="_blank">Конфиденциальность</a></li><!--]--></ul></div></div><div class="tm-footer-menu__block"><p class="tm-footer-menu__block-title">Услуги</p><div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><!--[--><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/corporate-blogs/" target="_blank">Корпоративный блог</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/advertising/" target="_blank">Медийная реклама</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/native-special/" target="_blank">Нативные проекты</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/education-programs/" target="_blank">Образовательные программы</a></li><li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/hello-startup/" target="_blank">Стартапам</a></li><!--]--></ul></div></div><!--]--></div><!--]--></div></div><div class="tm-footer"><div class="tm-page-width"><!--[--><div class="tm-footer__container"><!----><div class="social-icons tm-footer__social" data-v-d6e8cb42><!--[--><a class="tm-svg-icon__wrapper social-icon" href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" data-v-d6e8cb42><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>VK</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-vk"></use></svg></a><a class="tm-svg-icon__wrapper social-icon" href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" data-v-d6e8cb42><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Telegram</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a class="tm-svg-icon__wrapper social-icon" href="http://www.youtube.com/@Habr_com" rel="nofollow noopener noreferrer" target="_blank" data-v-d6e8cb42><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Youtube</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a class="tm-svg-icon__wrapper social-icon" href="https://dzen.ru/habr" rel="nofollow noopener noreferrer" target="_blank" data-v-d6e8cb42><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Яндекс Дзен</title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-dzen"></use></svg></a><!--]--></div><!--teleport start--><!--teleport end--><button class="tm-footer__link"><!----> Настройка языка</button><a href="/ru/feedback/" class="tm-footer__link">Техническая поддержка</a><div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2026,</span><span class="tm-copyright__name"><a class="tm-copyright__link" href="https://company.habr.com/" rel="noopener" target="_blank"> Habr </a></span></span></div></div><!--]--></div></div><!----><!----><!--]--></div><!----></div></div>
    <div id="overlays"><!--teleport start anchor--><template><!----></template><!--teleport anchor--><!--teleport start anchor--><template><!----></template><!--teleport anchor--><!--teleport start anchor--><template><!----></template><!----><!--teleport anchor--><!--teleport start anchor--><!----><!--teleport anchor--><!--teleport start anchor--><!----><!--teleport anchor--><!--teleport start anchor--><!----><!--teleport anchor--><!--teleport start anchor--><!----><!--teleport anchor--></div>
    
    
    
    
  
  
    
  
    </body>

    </html>
